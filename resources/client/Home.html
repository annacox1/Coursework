<html lang='en'>

<head>
    <link rel="stylesheet" href="css/style.css">


    <title>Odyssey Journal - Entries </title>
    <div class="vertical-menu">
        <a href="#" class="active">Entries</a>
        <a href="Calendar.html">Calendar</a>
        <a href="Maps.html">Maps</a>
    </div>

    <script>
        "use strict";

        function pageLoad() {
            console.log("Invoked pageLoad() ");
            getUserName();

        }

        function getUserName() {
            console.log("Invoked getUserName")
            const url = "/user/username";
            fetch(url, {
                method: "GET",
            }).then(response => {
                return response.json();
        }).
            then(response => {
                if(response.hasOwnProperty("Error")
        )
            {
                alert(JSON.stringify(response));
            }
        else
            {
                document.getElementById("name").innerHTML = response;
            }
        })
            ;
        }

        function getEntryList() {
            var x = document.getElementById("myDIV");
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
            console.log("Invoked getEntryList()");

            const url = "/entry/list";
            fetch(url, {
                method: "GET",
            }).then(response => {
                return response.json();
        }).
            then(response => {
                if(response.hasOwnProperty("Error")
        )
            {
                alert(JSON.stringify(response));
            }
        else
            {
                formatEntryList(response);
            }
        })
            ;
        }

        function formatEntryList(myJSON) {
            let dataHTML = "<th> ID </th><th> Title</th><th> Date</th><th> Content</th><th>Delete?</th></th>";

            for (let item of myJSON) {


                dataHTML += "<tr><td>" + item.EntryID + "</td><td>" + item.Title + "</td><td>" + item.Date + "</td><td>" + item.Content + "</td><td><button onclick='deleteEntry(item.EntryID);'>Delete</button></td></tr>";
            }
            document.getElementById("entryTable").innerHTML += dataHTML;


        }

        function deleteEntry(ID) {
            console.log("Invoked deleteEntry")
            console.log(ID);


            var url = "/entry/delete";
            var formData = new FormData(ID);

            fetch(url, {
                method: "POST",
                body: formData,
            }).then(response => {
                return response.json();
        }).
            then(response => {
                if(response.hasOwnProperty("Error")
        )
            {
                alert(JSON.stringify(response));
            }
        else
            {
                alert(" entry deleted");

            }
        })
            ;
        }


    </script>


</head>

<body onload="pageLoad()">
<h1>Welcome to Odyssey Journal</h1>
<div id="name">
    <p>*username goes here*</p>
</div>
<hr>


<div id="myDIV">
    <BR>
    <button onclick='getEntryList();'>Display Entries</button>
</div>
<BR>
<BR>


<div id="name"></div>

<div id="demo"></div>
<table id="entryTable">

</table>
<button onclick="document.location='createEvent.html'">Create Entry</button>

</body>

</html>