<!DOCTYPE html>
<html lang="en">
<head>

    <link rel="stylesheet" href="css/style.css">
    <script>

        function pageLoad() {
            console.log("Invoked pageLoad() ");
            getCategories();
            getUserName()


        }
        function getUserName(){
            console.log("Invoked getUserName")
            const url = "/user/username";
            fetch(url, {
                method : "GET",
            }).then(response=> {
                return response.json();
            }).then(response=> {
                if (response.hasOwnProperty("Error")){
                    alert(JSON.stringify(response));
                } else{
                    document.getElementById("name").innerHTML = response;
                }
            });
        }

        function getCategories() {
            console.log("Invoked getCategories() ");
            var url = "/entry/category";
            fetch(url, {
                method: "GET",
            }).then(response => {
                return response.json();
            }).then(response => {
                if (response.hasOwnProperty("Error")) {
                    alert(JSON.stringify(response));
                } else {
                    console.log(response);
                    populateCategoriesDropdown(response);
                }
            });
        }


        function populateCategoriesDropdown(response) {
            console.log("Invoked populateCategoriesDropdown() ");

            let html = "";
            for (let item of response) {
                html+= "<option value=" + item.CategoryID + ">" + item.Title + "</option>"
             }
            document.getElementById("ddlCategories").innerHTML = html;

        }

        function postCreateEntry() {
            console.log("Invoked postCreateEntry() ");

            var url = "/entry/add";
            var formData = new FormData(document.getElementById('entryForm'));

            fetch(url, {
                method: "POST",
                body: formData,
            }).then(response => {
                return response.json();
            }).then(response => {
                if (response.hasOwnProperty("Error")) {
                    alert(JSON.stringify(response));
                } else {
                    alert("new entry added");
                    ///  what to do when new entry added?
                }
            });
        }


    </script>


    <title>Create Entry</title>

    <div class="vertical-menu">
        <a href="#" class="active">Entries</a>
        <a href="Calendar.html">Calendar</a>
        <a href="Maps.html">Maps</a>
    </div>
</head>
<body onload="pageLoad()">
<table id="entryTable">

</table>

<h2>Create Entry</h2>

<div id ="name">
    <p>*username goes here*</p>
</div>
<hr>
<div class="col-2">

    <form id="entryForm">
        <p>Title:</p>
        <input type="text" name="title" id="title">

        <BR>
        <p>Date:</p>
        <input type="date" name="date" id="date">
        <BR>
        <p>Content:</p>
        <input type="text" name="content" id="content">
        <BR>

        <p>Category:</p>
        <select name="ddlCategories" id="ddlCategories">
        </select>


    </form>


    <BR>
    <button class="button" onclick='postCreateEntry();'>CREATE</button>
</div>

</body>
</html>